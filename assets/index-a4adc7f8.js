(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function n(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(a){if(a.ep)return;a.ep=!0;const l=n(a);fetch(a.href,l)}})();class y{constructor(e,n){this._date=e,this._attendees=n}get attendees(){return this._attendees}set attendees(e){this._attendees=e}get date(){return this._date}set date(e){this._date=e}_date;_attendees}class E{_id;_name;_author;_dates;_description;_createdAt;_numModification;_lastModification;constructor(e,n,i,a,l,d,s,o){this._id=e,this._name=n,this._author=i,this._dates=a,this._createdAt=l,this._numModification=d,this._lastModification=s,this._description=o}get lastModification(){return this._lastModification}set lastModification(e){this._lastModification=e}get numModification(){return this._numModification}set numModification(e){this._numModification=e}get createdAt(){return this._createdAt}set createdAt(e){this._createdAt=e}get description(){return this._description}set description(e){this._description=e}get dates(){return this._dates}set dates(e){this._dates=e}get author(){return this._author}set author(e){this._author=e}get name(){return this._name}set name(e){this._name=e}get id(){return this._id}}class A{get available(){return this._available}set available(e){this._available=e}constructor(e,n){this._name=e,this._available=n}get name(){return this._name}set name(e){this._name=e}_name;_available}function g(t){let e=[];for(let n of t.dates){let i=S(n);i!==void 0&&e.push(i)}return e?new E(t.id,t.name,t.author,e,new Date(t.created_at),Number(t.num_modification),new Date(t.last_modification),t.description?t.description:void 0):void 0}function S(t){return t?new y(new Date(t.date),t.attendees.map(e=>_(e))):void 0}function _(t){return t?new A(t.name,t.available!==void 0?t.available:null):void 0}let L=`        
            <div class="card-header d-flex flex-row justify-content-between">
            <div> 
            <h2 class="eventName editableEventProp" contenteditable="false"></h2>
            <h5 class="eventAuthor editableEventProp" contenteditable="false"></h5>
            <p class="eventDesc editableEventProp" contenteditable="false"></p>
            </div>
            <div class="d-flex flex-column">
            <button class="btn btn-secondary editEventBtn align-self-center">Edit</button>
            <button class="btn btn-secondary saveEventBtn align-self-center d-none">Save</button>
            </div>
            </div>
            <div class="card-body">
                <table class="table">
                    <thead>
                    <tr class="DatesList">
                        <th scope="col">#</th>
                    </tr>
                    </thead>
                    <tbody class="tableBody">
                    </tbody>
                </table>
            </div>
            <div class="card-footer">
            <button class="btn btn-secondary addAttendeesBtn">Add Attendees</button>
            <button class="btn btn-secondary addDatesBtn">Add Dates</button>
            <button class="btn btn-secondary saveAttendees" disabled>Save Attendees</button>
            <button class="btn btn-secondary cancelEventModif" disabled>Cancel</button>
            </div>`;function m(t,e){let n=document.createElement("tr");n.classList.add("attendeeInfo"),n.setAttribute("Editing",(!e).toString());let i=document.createElement("td");i.classList.add("attendeeName");let a=document.createElement("input");return a.classList.add("attendeeNameInput"),a.setAttribute("type","text"),a.required=!0,a.value=t,a.readOnly=e,i.appendChild(a),n.appendChild(i),n}function p(t,e,n){let i=document.createElement("td");i.classList.add("attendeeAvailability");let a=document.createElement("select");a.setAttribute("id",`availability_${n}_${e}_${t.getTime()}`);let l=document.createElement("option");l.setAttribute("value","true"),l.innerText="Available";let d=document.createElement("option");d.setAttribute("value","false"),d.innerText="Not available";let s=document.createElement("option");return s.setAttribute("value","null"),s.innerText="Don't know yet",a.append(l,d,s),i.appendChild(a),i}function q(t){let e=[];for(let n of t.dates){let i=document.createElement("th");i.setAttribute("scope","col"),i.classList.add("eventDate"),i.innerText=n.date.toDateString(),e.push(i)}return e}function D(t,e){q(t).forEach(i=>e.appendChild(i))}function B(t,e){let n=t.dates.map(a=>a.date),i=te(t);for(let a of i){let l=m(a,!0);for(let d of n){let s=T(d,a,t);l.appendChild(s)}e.appendChild(l)}}function C(t,e){let n=t.querySelector("select");switch(e){case!0:n.value="true";break;case!1:n.value="false";break;case void 0:case null:n.value="null";break}return t}function T(t,e,n){let i=p(t,e,n.id),a=ee(t,e,n);return C(i,a),i}let N="http://localHost:3000/api/",r=`${N}events/`;function h(t){return t<9?`0${t+1}`:`${t+1}`}function b(t){return t<10?`0${t}`:`${t}`}function u(t){return t===null||t.trim()===""||!1}async function M(t,e,n,i){let a=[];for(let o of i){let c=`${o.getFullYear()}-${h(o.getMonth())}-${b(o.getDate())}`;a.push(c)}let l={name:t,dates:a,author:e,description:n};const d={"Content-Type":"application/json",Accept:"*/*",Host:"localhost:3000","Accept-Encoding":"gzip, deflate, br"},s=new Headers(d);return fetch(r,{method:"POST",body:JSON.stringify(l),headers:s}).then(o=>o.json()).then(o=>o.id).catch(o=>console.log(o.message))}function H(t){let e=document.getElementById(t.id).querySelector(".tableBody"),n=m("",!1);for(let i of t.dates){let a=p(i.date,"",t.id);n.appendChild(a)}return e.appendChild(n),n}async function $(t,e,n){let a={name:n.querySelector(".attendeeNameInput").value,dates:w(t,e,n)};const l={"Content-Type":"application/json",Accept:"*/*",Host:"localhost:3000","Accept-Encoding":"gzip, deflate, br"},d=new Headers(l);let s=`${r}${t}/attend`;return fetch(s,{method:"POST",body:JSON.stringify(a),headers:d}).then(o=>o.json()).then(o=>o.id).catch(o=>console.log(o.message))}function w(t,e,n){let i=[];return e.forEach(a=>{let l=x(t,a.date,n);l!=null&&i.push(l)}),i}function x(t,e,n){let i=`availability_${t}__${e.getTime()}`,a=n.querySelector("select#"+CSS.escape(i)),l=`${e.getFullYear()}-${h(e.getMonth())}-${b(e.getDate())}`;switch(a.value){case"true":return{date:l,available:!0};case"false":return{date:l,available:!1}}}async function I(t,e,n,i){let a=`${r}${t}`,l={name:e,author:n,description:i};const d={"Content-Type":"application/json",Accept:"*/*",Host:"localhost:3000","Accept-Encoding":"gzip, deflate, br"},s=new Headers(d);return fetch(a,{method:"PATCH",body:JSON.stringify(l),headers:s}).then(o=>o.json()).then(o=>o.id).catch(o=>console.log(o.message))}function O(t,e,n){return!u(e)&&!u(t)&&!u(n)}let P=document.querySelector(".addEvent"),f=document.querySelector(".createEvent"),F=document.querySelector(".datesList"),j=document.querySelector(".addDate");function k(){G(P,f),Y(f),K(j,F)}function z(t){let e=document.getElementById(t.id),n=e.querySelector(".card-footer").querySelector(".addAttendeesBtn"),i=e.querySelector("button.saveAttendees"),a=e.querySelector("button.cancelEventModif");n.addEventListener("click",function(l){l.preventDefault(),H(t),a.disabled=!1,i.disabled=!1})}function G(t,e){t.addEventListener("click",function(){e.classList.remove("d-none")})}function J(t){let e=document.getElementById(t.id),n=e.querySelector("button.cancelEventModif"),i=e.querySelector(".saveAttendees");n.addEventListener("click",function(){let a=e.querySelectorAll("[editing='true']");a!=null&&a.length>0&&a.forEach(l=>{l.parentNode!==null&&l.parentNode.removeChild(l)}),i.disabled=!0,n.disabled=!0})}function R(t){let e=document.getElementById(t.id),n=e.querySelector(".saveAttendees"),i=e.querySelector(".cancelEventModif");n.addEventListener("click",async function(){let a=e.querySelectorAll(".attendeeInfo[editing='true']");if(a!==null&&a.length>0)for(const l of a)await $(t.id,t.dates,l),l.setAttribute("editing","false");n.disabled=!0,i.disabled=!0})}function Y(t){t.addEventListener("submit",async function(){let n=document.querySelector("#eventName").value,a=document.querySelector("#eventAuthor").value,d=document.querySelector("#eventDescription").value,s=document.getElementsByName("createEventDate"),o=[];for(let c of s)o.push(new Date(c.value));await M(n,a,d,o),f.classList.add("d-none"),await v()})}function K(t,e){t.addEventListener("click",function(n){n.preventDefault();let i=document.createElement("input");i.setAttribute("type","date"),i.setAttribute("name","createEventDate"),e.appendChild(i)})}function U(t){let e=document.getElementById(t.id),n=e.querySelector(".editEventBtn"),i=e.querySelector(".saveEventBtn");n.addEventListener("click",function(){n.classList.add("d-none"),i.classList.remove("d-none");let l=document.getElementById(t.id).querySelectorAll(".card-header .editableEventProp");V(l)})}function V(t){t.forEach(e=>{e.contentEditable="true"})}function Q(t){let e=document.getElementById(t.id),n=e.querySelector(".editEventBtn"),i=e.querySelector(".saveEventBtn");i.addEventListener("click",async function(){let a=e.querySelector(".eventName.editableEventProp"),l=e.querySelector(".eventAuthor.editableEventProp"),d=e.querySelector(".eventDesc.editableEventProp");O(a.innerText,l.innerText,d.innerText)&&await I(t.id,a.innerText,l.innerText,d.innerText),n.classList.remove("d-none"),i.classList.add("d-none"),await v()})}function W(t){let e=document.querySelector(".eventsContainer");e.innerHTML="";for(let n of t)X(n),z(n),R(n),J(n),U(n),Q(n)}function X(t){let e=document.querySelector(".eventsContainer"),n=document.createElement("div");n.setAttribute("id",t.id),n.classList.add("card","didlydooEvent"),n.innerHTML=L,Z(t,n),e.appendChild(n)}function Z(t,e){let n=e.querySelector(".eventName");n.innerText=t.name;let i=e.querySelector(".eventAuthor");i.innerText=t.author;let a=e.querySelector(".eventDesc");t.description!==void 0&&(a.innerText=t.description);let l=e.querySelector(".DatesList"),d=e.querySelector(".tableBody");D(t,l),B(t,d)}async function v(){return fetch(r).then(t=>t.json()).then(t=>Array.isArray(t)?t.map(e=>g(e)):[]).then(t=>{let e=[];t.forEach(n=>{n!==void 0&&e.push(n)}),W(e)}).catch(t=>t.message)}function ee(t,e,n){let i=n.dates!==void 0?n.dates.find(l=>l.date===t):void 0,a=i!==void 0&&i.attendees!==void 0?i.attendees.find(l=>l.name===e):void 0;return a!==void 0?a.available:void 0}function te(t){let e=[];for(let n of t.dates)if(n.attendees!==void 0)for(let i of n.attendees)i!=null&&e.push(i);return[...new Set(e.map(n=>n.name))]}await v();k();
