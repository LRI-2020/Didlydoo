(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(a){if(a.ep)return;a.ep=!0;const l=n(a);fetch(a.href,l)}})();class y{constructor(e,n){this._date=e,this._attendees=n}get attendees(){return this._attendees}set attendees(e){this._attendees=e}get date(){return this._date}set date(e){this._date=e}_date;_attendees}class b{_id;_name;_author;_dates;_description;_createdAt;_numModification;_lastModification;constructor(e,n,i,a,l,o,d,s){this._id=e,this._name=n,this._author=i,this._dates=a,this._createdAt=l,this._numModification=o,this._lastModification=d,this._description=s}get lastModification(){return this._lastModification}set lastModification(e){this._lastModification=e}get numModification(){return this._numModification}set numModification(e){this._numModification=e}get createdAt(){return this._createdAt}set createdAt(e){this._createdAt=e}get description(){return this._description}set description(e){this._description=e}get dates(){return this._dates}set dates(e){this._dates=e}get author(){return this._author}set author(e){this._author=e}get name(){return this._name}set name(e){this._name=e}get id(){return this._id}}class A{get available(){return this._available}set available(e){this._available=e}constructor(e,n){this._name=e,this._available=n}get name(){return this._name}set name(e){this._name=e}_name;_available}function E(t){let e=[];for(let n of t.dates){let i=_(n);i!==void 0&&e.push(i)}return e?new b(t.id,t.name,t.author,e,new Date(t.created_at),Number(t.num_modification),new Date(t.last_modification),t.description?t.description:void 0):void 0}function _(t){return t?new y(new Date(t.date),t.attendees.map(e=>g(e))):void 0}function g(t){return t?new A(t.name,t.available!==void 0?t.available:null):void 0}let S=`        
            <div class="card-header">
                <h2 class="eventName">Event NAme</h2>
                <h3 class="eventAuthor"> Author name</h3>
                <p class="eventDesc">une longue description d'une veent ou pas</p>
            </div>
            <div class="card-body">
                <table class="table">
                    <thead>
                    <tr class="DatesList">
                        <th scope="col">#</th>
                    </tr>
                    </thead>
                    <tbody class="tableBody">
                    </tbody>
                </table>
            </div>
            <div class="card-footer">
            <button class="btn btn-secondary addAttendeesBtn">Add Attendees</button>
            <button class="btn btn-secondary addDatesBtn">Add Dates</button>
            <button class="btn btn-secondary saveAttendees" disabled>Save Attendees</button>
            <button class="btn btn-secondary cancelEventModif" disabled>Cancel</button>
            </div>`;function f(t,e){let n=document.createElement("tr");n.classList.add("attendeeInfo"),n.setAttribute("Editing",(!e).toString());let i=document.createElement("td");i.classList.add("attendeeName");let a=document.createElement("input");return a.classList.add("attendeeNameInput"),a.setAttribute("type","text"),a.required=!0,a.value=t,a.readOnly=e,i.appendChild(a),n.appendChild(i),n}function m(t,e,n){let i=document.createElement("td");i.classList.add("attendeeAvailability");let a=document.createElement("select");a.setAttribute("id",`availability_${n}_${e}_${t.getTime()}`);let l=document.createElement("option");l.setAttribute("value","true"),l.innerText="Available";let o=document.createElement("option");o.setAttribute("value","false"),o.innerText="Not available";let d=document.createElement("option");return d.setAttribute("value","null"),d.innerText="Don't know yet",a.append(l,o,d),i.appendChild(a),i}function D(t){let e=[];for(let n of t.dates){let i=document.createElement("th");i.setAttribute("scope","col"),i.classList.add("eventDate"),i.innerText=n.date.toDateString(),e.push(i)}return e}function L(t,e){D(t).forEach(i=>e.appendChild(i))}function q(t,e){let n=t.dates.map(a=>a.date),i=U(t);for(let a of i){let l=f(a,!0);for(let o of n){let d=B(o,a,t);l.appendChild(d)}e.appendChild(l)}}function C(t,e){let n=t.querySelector("select");switch(e){case!0:n.value="true";break;case!1:n.value="false";break;case void 0:case null:n.value="null";break}return t}function B(t,e,n){let i=m(t,e,n.id),a=Q(t,e,n);return C(i,a),i}let M="http://localHost:3000/api/",u=`${M}events/`;function h(t){return t<9?`0${t+1}`:`${t+1}`}function p(t){return t<10?`0${t}`:`${t}`}async function N(t,e,n,i){let a=[];for(let s of i){let r=`${s.getFullYear()}-${h(s.getMonth())}-${p(s.getDate())}`;a.push(r)}let l={name:t,dates:a,author:e,description:n};const o={"Content-Type":"application/json",Accept:"*/*",Host:"localhost:3000","Accept-Encoding":"gzip, deflate, br"},d=new Headers(o);return fetch(u,{method:"POST",body:JSON.stringify(l),headers:d}).then(s=>s.json()).then(s=>s.id).catch(s=>console.log(s.message))}function T(t){let e=document.getElementById(t.id).querySelector(".tableBody"),n=f("",!1);for(let i of t.dates){let a=m(i.date,"",t.id);n.appendChild(a)}return e.appendChild(n),n}async function $(t,e,n){let a={name:n.querySelector(".attendeeNameInput").value,dates:H(t,e,n)};const l={"Content-Type":"application/json",Accept:"*/*",Host:"localhost:3000","Accept-Encoding":"gzip, deflate, br"},o=new Headers(l);let d=`${u}${t}/attend`;return fetch(d,{method:"POST",body:JSON.stringify(a),headers:o}).then(s=>s.json()).then(s=>s.id).catch(s=>console.log(s.message))}function H(t,e,n){let i=[];return e.forEach(a=>{let l=O(t,a.date,n);l!=null&&i.push(l)}),i}function O(t,e,n){let i=`availability_${t}__${e.getTime()}`,a=n.querySelector("select#"+CSS.escape(i)),l=`${e.getFullYear()}-${h(e.getMonth())}-${p(e.getDate())}`;switch(a.value){case"true":return{date:l,available:!0};case"false":return{date:l,available:!1}}}let F=document.querySelector(".addEvent"),c=document.querySelector(".createEvent"),I=document.querySelector(".datesList"),w=document.querySelector(".addDate");function x(){j(F,c),z(c),J(w,I)}function P(t){let e=document.getElementById(t.id),n=e.querySelector(".card-footer").querySelector(".addAttendeesBtn"),i=e.querySelector("button.saveAttendees"),a=e.querySelector("button.cancelEventModif");n.addEventListener("click",function(l){l.preventDefault(),T(t),a.disabled=!1,i.disabled=!1})}function j(t,e){t.addEventListener("click",function(){e.classList.remove("d-none")})}function k(t){let e=document.getElementById(t.id),n=e.querySelector("button.cancelEventModif"),i=e.querySelector(".saveAttendees");n.addEventListener("click",function(){let a=e.querySelectorAll("[editing='true']");a!=null&&a.length>0&&a.forEach(l=>{l.parentNode!==null&&l.parentNode.removeChild(l)}),i.disabled=!0,n.disabled=!0})}function G(t){let e=document.getElementById(t.id),n=e.querySelector(".saveAttendees"),i=e.querySelector(".cancelEventModif");n.addEventListener("click",async function(){let a=e.querySelectorAll(".attendeeInfo[editing='true']");if(a!==null&&a.length>0)for(const l of a)await $(t.id,t.dates,l),l.setAttribute("editing","false");n.disabled=!0,i.disabled=!0})}function z(t){t.addEventListener("submit",async function(){let n=document.querySelector("#eventName").value,a=document.querySelector("#eventAuthor").value,o=document.querySelector("#eventDescription").value,d=document.getElementsByName("createEventDate"),s=[];for(let r of d)s.push(new Date(r.value));await N(n,a,o,s),c.classList.add("d-none"),await v()})}function J(t,e){t.addEventListener("click",function(n){n.preventDefault();let i=document.createElement("input");i.setAttribute("type","date"),i.setAttribute("name","createEventDate"),e.appendChild(i)})}function R(t){for(let e of t)Y(e),P(e),G(e),k(e)}function Y(t){let e=document.querySelector(".eventsContainer"),n=document.createElement("div");n.setAttribute("id",t.id),n.classList.add("card","didlydooEvent"),n.innerHTML=S,K(t,n),e.appendChild(n)}function K(t,e){let n=e.querySelector(".eventName");n.innerText=t.name;let i=e.querySelector(".eventAuthor");i.innerText=t.author;let a=e.querySelector(".eventDesc");t.description!==void 0&&(a.innerText=t.description);let l=e.querySelector(".DatesList"),o=e.querySelector(".tableBody");L(t,l),q(t,o)}async function v(){return fetch(u).then(t=>t.json()).then(t=>Array.isArray(t)?t.map(e=>E(e)):[]).then(t=>{let e=[];t.forEach(n=>{n!==void 0&&e.push(n)}),R(e)}).catch(t=>t.message)}function Q(t,e,n){let i=n.dates!==void 0?n.dates.find(l=>l.date===t):void 0,a=i!==void 0&&i.attendees!==void 0?i.attendees.find(l=>l.name===e):void 0;return a!==void 0?a.available:void 0}function U(t){let e=[];for(let n of t.dates)if(n.attendees!==void 0)for(let i of n.attendees)i!=null&&e.push(i);return[...new Set(e.map(n=>n.name))]}await v();x();
