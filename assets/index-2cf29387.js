(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();class b{constructor(e,n){this._date=e,this._attendees=n}get attendees(){return this._attendees}set attendees(e){this._attendees=e}get date(){return this._date}set date(e){this._date=e}_date;_attendees}class E{_id;_name;_author;_dates;_description;_createdAt;_numModification;_lastModification;constructor(e,n,l,a,i,d,s,o){this._id=e,this._name=n,this._author=l,this._dates=a,this._createdAt=i,this._numModification=d,this._lastModification=s,this._description=o}get lastModification(){return this._lastModification}set lastModification(e){this._lastModification=e}get numModification(){return this._numModification}set numModification(e){this._numModification=e}get createdAt(){return this._createdAt}set createdAt(e){this._createdAt=e}get description(){return this._description}set description(e){this._description=e}get dates(){return this._dates}set dates(e){this._dates=e}get author(){return this._author}set author(e){this._author=e}get name(){return this._name}set name(e){this._name=e}get id(){return this._id}}class A{get available(){return this._available}set available(e){this._available=e}constructor(e,n){this._name=e,this._available=n}get name(){return this._name}set name(e){this._name=e}_name;_available}function g(t){let e=[];for(let n of t.dates){let l=S(n);l!==void 0&&e.push(l)}return e?new E(t.id,t.name,t.author,e,new Date(t.created_at),Number(t.num_modification),new Date(t.last_modification),t.description?t.description:void 0):void 0}function S(t){return t?new b(new Date(t.date),t.attendees.map(e=>_(e))):void 0}function _(t){return t?new A(t.name,t.available!==void 0?t.available:null):void 0}let L=`        
            <div class="card-header d-flex flex-row justify-content-between">
            <div> 
            <h2 class="eventName editableEventProp" contenteditable="false"></h2>
            <h5 class="eventAuthor editableEventProp" contenteditable="false"></h5>
            <p class="eventDesc editableEventProp" contenteditable="false"></p>
            </div>
            <div class="d-flex flex-column">
            <button class="btn btn-secondary my-1 editEventBtn align-self-center">Edit</button>
            <button class="btn btn-secondary my-1 saveEventBtn align-self-center d-none">Save</button>
            <button class="btn btn-secondary my-1 deleteEventBtn align-self-center">Delete</button>
            </div>
            </div>
            <div class="card-body">
                <table class="table">
                    <thead>
                    <tr class="DatesList">
                        <th scope="col">#</th>
                    </tr>
                    </thead>
                    <tbody class="tableBody">
                    </tbody>
                </table>
            </div>
            <div class="card-footer">
            <button class="btn btn-secondary addAttendeesBtn">Add Attendees</button>
            <button class="btn btn-secondary addDatesBtn">Add Dates</button>
            <button class="btn btn-secondary saveAttendees" disabled>Save Attendees</button>
            <button class="btn btn-secondary cancelEventModif" disabled>Cancel</button>
            </div>`;function m(t,e){let n=document.createElement("tr");n.classList.add("attendeeInfo"),n.setAttribute("Editing",(!e).toString());let l=document.createElement("td");l.classList.add("attendeeName");let a=document.createElement("input");return a.classList.add("attendeeNameInput"),a.setAttribute("type","text"),a.required=!0,a.value=t,a.readOnly=e,l.appendChild(a),n.appendChild(l),n}function h(t,e,n){let l=document.createElement("td");l.classList.add("attendeeAvailability");let a=document.createElement("select");a.setAttribute("id",`availability_${n}_${e}_${t.getTime()}`);let i=document.createElement("option");i.setAttribute("value","true"),i.innerText="Available";let d=document.createElement("option");d.setAttribute("value","false"),d.innerText="Not available";let s=document.createElement("option");return s.setAttribute("value","null"),s.innerText="Don't know yet",a.append(i,d,s),l.appendChild(a),l}function D(t){let e=[];for(let n of t.dates){let l=document.createElement("th");l.setAttribute("scope","col"),l.classList.add("eventDate"),l.innerText=n.date.toDateString(),e.push(l)}return e}function q(t,e){D(t).forEach(l=>e.appendChild(l))}function B(t,e){let n=t.dates.map(a=>a.date),l=ae(t);for(let a of l){let i=m(a,!0);for(let d of n){let s=T(d,a,t);i.appendChild(s)}e.appendChild(i)}}function C(t,e){let n=t.querySelector("select");switch(e){case!0:n.value="true";break;case!1:n.value="false";break;case void 0:case null:n.value="null";break}return t}function T(t,e,n){let l=h(t,e,n.id),a=ne(t,e,n);return C(l,a),l}let N="http://localHost:3000/api/",r=`${N}events/`;function p(t){return t<9?`0${t+1}`:`${t+1}`}function y(t){return t<10?`0${t}`:`${t}`}function f(t){return t===null||t.trim()===""||!1}async function M(t,e,n,l){let a=[];for(let o of l){let u=`${o.getFullYear()}-${p(o.getMonth())}-${y(o.getDate())}`;a.push(u)}let i={name:t,dates:a,author:e,description:n};const d={"Content-Type":"application/json",Accept:"*/*",Host:"localhost:3000","Accept-Encoding":"gzip, deflate, br"},s=new Headers(d);return fetch(r,{method:"POST",body:JSON.stringify(i),headers:s}).then(o=>o.json()).then(o=>o.id).catch(o=>console.log(o.message))}function $(t){let e=document.getElementById(t.id).querySelector(".tableBody"),n=m("",!1);for(let l of t.dates){let a=h(l.date,"",t.id);n.appendChild(a)}return e.appendChild(n),n}async function w(t,e,n){let a={name:n.querySelector(".attendeeNameInput").value,dates:H(t,e,n)};const i={"Content-Type":"application/json",Accept:"*/*",Host:"localhost:3000","Accept-Encoding":"gzip, deflate, br"},d=new Headers(i);let s=`${r}${t}/attend`;return fetch(s,{method:"POST",body:JSON.stringify(a),headers:d}).then(o=>o.json()).then(o=>o.id).catch(o=>console.log(o.message))}function H(t,e,n){let l=[];return e.forEach(a=>{let i=x(t,a.date,n);i!=null&&l.push(i)}),l}function x(t,e,n){let l=`availability_${t}__${e.getTime()}`,a=n.querySelector("select#"+CSS.escape(l)),i=`${e.getFullYear()}-${p(e.getMonth())}-${y(e.getDate())}`;switch(a.value){case"true":return{date:i,available:!0};case"false":return{date:i,available:!1}}}async function I(t,e,n,l){let a=`${r}${t}`,i={name:e,author:n,description:l};const d={"Content-Type":"application/json",Accept:"*/*",Host:"localhost:3000","Accept-Encoding":"gzip, deflate, br"},s=new Headers(d);return fetch(a,{method:"PATCH",body:JSON.stringify(i),headers:s}).then(o=>o.json()).then(o=>o.id).catch(o=>console.log(o.message))}function O(t,e,n){return!f(e)&&!f(t)&&!f(n)}async function P(t){let e=`${r}${t}`;return fetch(e,{method:"DELETE"}).then(n=>n.json()).then(n=>n.json()).catch(n=>n.message)}let F=document.querySelector(".addEvent"),v=document.querySelector(".createEvent"),j=document.querySelector(".datesList"),k=document.querySelector(".addDate");function z(){J(F,v),K(v),U(k,j)}function G(t){let e=document.getElementById(t.id),n=e.querySelector(".card-footer").querySelector(".addAttendeesBtn"),l=e.querySelector("button.saveAttendees"),a=e.querySelector("button.cancelEventModif");n.addEventListener("click",function(i){i.preventDefault(),$(t),a.disabled=!1,l.disabled=!1})}function J(t,e){t.addEventListener("click",function(){e.classList.remove("d-none")})}function R(t){let e=document.getElementById(t.id),n=e.querySelector("button.cancelEventModif"),l=e.querySelector(".saveAttendees");n.addEventListener("click",function(){let a=e.querySelectorAll("[editing='true']");a!=null&&a.length>0&&a.forEach(i=>{i.parentNode!==null&&i.parentNode.removeChild(i)}),l.disabled=!0,n.disabled=!0})}function Y(t){let e=document.getElementById(t.id),n=e.querySelector(".saveAttendees"),l=e.querySelector(".cancelEventModif");n.addEventListener("click",async function(){let a=e.querySelectorAll(".attendeeInfo[editing='true']");if(a!==null&&a.length>0)for(const i of a)await w(t.id,t.dates,i),i.setAttribute("editing","false");n.disabled=!0,l.disabled=!0})}function K(t){t.addEventListener("submit",async function(){let n=document.querySelector("#eventName").value,a=document.querySelector("#eventAuthor").value,d=document.querySelector("#eventDescription").value,s=document.getElementsByName("createEventDate"),o=[];for(let u of s)o.push(new Date(u.value));await M(n,a,d,o),v.classList.add("d-none"),await c()})}function U(t,e){t.addEventListener("click",function(n){n.preventDefault();let l=document.createElement("input");l.setAttribute("type","date"),l.setAttribute("name","createEventDate"),e.appendChild(l)})}function V(t){let e=document.getElementById(t.id),n=e.querySelector(".editEventBtn"),l=e.querySelector(".saveEventBtn");n.addEventListener("click",function(){n.classList.add("d-none"),l.classList.remove("d-none");let i=document.getElementById(t.id).querySelectorAll(".card-header .editableEventProp");Q(i)})}function Q(t){t.forEach(e=>{e.contentEditable="true"})}function W(t){let e=document.getElementById(t.id),n=e.querySelector(".editEventBtn"),l=e.querySelector(".saveEventBtn");l.addEventListener("click",async function(){let a=e.querySelector(".eventName.editableEventProp"),i=e.querySelector(".eventAuthor.editableEventProp"),d=e.querySelector(".eventDesc.editableEventProp");O(a.innerText,i.innerText,d.innerText)&&await I(t.id,a.innerText,i.innerText,d.innerText),n.classList.remove("d-none"),l.classList.add("d-none"),await c()})}function X(t){document.getElementById(t.id).querySelector("button.deleteEventBtn").addEventListener("click",async function(){await P(t.id),await c()})}function Z(t){let e=document.querySelector(".eventsContainer");e.innerHTML="";for(let n of t)ee(n),G(n),Y(n),R(n),V(n),W(n),X(n)}function ee(t){let e=document.querySelector(".eventsContainer"),n=document.createElement("div");n.setAttribute("id",t.id),n.classList.add("card","didlydooEvent","my-2"),n.innerHTML=L,te(t,n),e.appendChild(n)}function te(t,e){let n=e.querySelector(".eventName");n.innerText=t.name;let l=e.querySelector(".eventAuthor");l.innerText=t.author;let a=e.querySelector(".eventDesc");t.description!==void 0&&(a.innerText=t.description);let i=e.querySelector(".DatesList"),d=e.querySelector(".tableBody");q(t,i),B(t,d)}async function c(){return fetch(r).then(t=>t.json()).then(t=>Array.isArray(t)?t.map(e=>g(e)):[]).then(t=>{let e=[];t.forEach(n=>{n!==void 0&&e.push(n)}),Z(e)}).catch(t=>t.message)}function ne(t,e,n){let l=n.dates!==void 0?n.dates.find(i=>i.date===t):void 0,a=l!==void 0&&l.attendees!==void 0?l.attendees.find(i=>i.name===e):void 0;return a!==void 0?a.available:void 0}function ae(t){let e=[];for(let n of t.dates)if(n.attendees!==void 0)for(let l of n.attendees)l!=null&&e.push(l);return[...new Set(e.map(n=>n.name))]}await c();z();
